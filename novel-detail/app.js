// Application Data
const NOVEL_DATA = {
  "novel": {
    "id": "novel1",
    "title": "The Digital Dreamer",
    "author": "Sarah Chen",
    "authorId": "user2",
    "description": "In the neon-lit streets of Neo-Tokyo 2087, Maya Rodriguez isn't just any hackerâ€”she's a dream architect. By day, she codes security protocols for mega-corporations. By night, she delves into the forbidden art of neural interface programming, developing technology that can bridge the gap between digital reality and human consciousness.\n\nWhen Maya discovers a way to enter and navigate human dreams through virtual reality, she believes she's found the ultimate frontier of human experience. But her first dream-dive reveals a chilling truth: she's not the first to discover this technology. A shadowy organization has been using dream-hacking to manipulate people's subconscious minds, planting thoughts, stealing memories, and controlling behavior on a massive scale.\n\nNow Maya must navigate a labyrinth of digital dreams and virtual nightmares to expose the conspiracy before it's too late. With the help of her partner Jake, a former military cybersecurity expert, and Dr. Elena Vasquez, a neuroscientist studying consciousness, Maya races against time to prevent the complete subjugation of human free will.\n\nThe Digital Dreamer is a thrilling cyberpunk adventure that explores the boundaries between technology and consciousness, reality and simulation, freedom and control. In a world where your dreams are no longer private, who can you trust?",
    "coverUrl": "https://via.placeholder.com/400x600/BF40BF/FFFFFF?text=The+Digital+Dreamer",
    "genre": "Cyberpunk",
    "tags": ["AI", "Dreams", "Hacking", "Technology", "Future", "Neural Interface", "Conspiracy", "Virtual Reality"],
    "status": "ongoing",
    "difficulty": "intermediate",
    "language": "English",
    "contentWarnings": ["Violence", "Strong Language", "Mature Themes"],
    "createdAt": "2024-08-15",
    "updatedAt": "2024-09-20",
    "lastChapterDate": "2024-09-20",
    "chapters": 15,
    "totalWords": 45000,
    "estimatedReadTime": "3 hours",
    "isCompleted": false,
    "stats": {
      "views": 12456,
      "likes": 892,
      "comments": 234,
      "rating": 4.7,
      "totalRatings": 1547,
      "inLibraries": 2341,
      "shares": 156
    },
    "ratingBreakdown": {
      "5": 856,
      "4": 445,
      "3": 156,
      "2": 67,
      "1": 23
    }
  },
  "author": {
    "id": "user2",
    "name": "Sarah Chen",
    "avatar": "https://via.placeholder.com/100x100/4A90E2/FFFFFF?text=SC",
    "bio": "Sarah Chen is a software engineer turned novelist who brings her deep understanding of technology to her cyberpunk fiction. Based in San Francisco, she has worked for major tech companies and uses her insider knowledge to create authentic, thrilling stories about our digital future. The Digital Dreamer is her debut novel, but she has several more cyberpunk adventures planned.",
    "joinedDate": "2024-02-10",
    "stats": {
      "novels": 1,
      "followers": 2341,
      "totalViews": 12456,
      "totalLikes": 892
    },
    "socialLinks": {
      "twitter": "@sarahchen_writes",
      "website": "sarahchenauthor.com",
      "goodreads": "sarah-chen-author"
    },
    "isFollowed": false
  },
  "chapters": [
    {
      "id": "ch1",
      "number": 1,
      "title": "The First Dive",
      "wordCount": 3200,
      "readTime": "12 min",
      "publishedAt": "2024-08-15",
      "isRead": true
    },
    {
      "id": "ch2",
      "number": 2,
      "title": "Digital Phantoms",
      "wordCount": 2950,
      "readTime": "11 min",
      "publishedAt": "2024-08-17",
      "isRead": true
    },
    {
      "id": "ch3",
      "number": 3,
      "title": "The Network Awakens",
      "wordCount": 3100,
      "readTime": "12 min",
      "publishedAt": "2024-08-20",
      "isRead": false
    },
    {
      "id": "ch4",
      "number": 4,
      "title": "Memory Fragments",
      "wordCount": 2800,
      "readTime": "10 min",
      "publishedAt": "2024-08-23",
      "isRead": false
    },
    {
      "id": "ch5",
      "number": 5,
      "title": "The Corporation's Shadow",
      "wordCount": 3400,
      "readTime": "13 min",
      "publishedAt": "2024-08-26",
      "isRead": false
    },
    {
      "id": "ch6",
      "number": 6,
      "title": "Allies in the Code",
      "wordCount": 3050,
      "readTime": "11 min",
      "publishedAt": "2024-08-29",
      "isRead": false
    },
    {
      "id": "ch7",
      "number": 7,
      "title": "The Dream Thieves",
      "wordCount": 3300,
      "readTime": "12 min",
      "publishedAt": "2024-09-02",
      "isRead": false
    },
    {
      "id": "ch8",
      "number": 8,
      "title": "Neural Storm",
      "wordCount": 2900,
      "readTime": "11 min",
      "publishedAt": "2024-09-05",
      "isRead": false
    },
    {
      "id": "ch9",
      "number": 9,
      "title": "The Resistance Forms",
      "wordCount": 3150,
      "readTime": "12 min",
      "publishedAt": "2024-09-08",
      "isRead": false
    },
    {
      "id": "ch10",
      "number": 10,
      "title": "Infiltrating the Dream Web",
      "wordCount": 3500,
      "readTime": "13 min",
      "publishedAt": "2024-09-12",
      "isRead": false
    },
    {
      "id": "ch11",
      "number": 11,
      "title": "The Mind Controller",
      "wordCount": 3250,
      "readTime": "12 min",
      "publishedAt": "2024-09-15",
      "isRead": false
    },
    {
      "id": "ch12",
      "number": 12,
      "title": "Breaking the Neural Chains",
      "wordCount": 3400,
      "readTime": "13 min",
      "publishedAt": "2024-09-18",
      "isRead": false
    },
    {
      "id": "ch13",
      "number": 13,
      "title": "The Final Protocol",
      "wordCount": 3600,
      "readTime": "14 min",
      "publishedAt": "2024-09-20",
      "isRead": false
    },
    {
      "id": "ch14",
      "number": 14,
      "title": "Digital Revolution",
      "wordCount": 0,
      "readTime": "Coming Soon",
      "publishedAt": null,
      "isRead": false,
      "isUpcoming": true
    },
    {
      "id": "ch15",
      "number": 15,
      "title": "The Dream Ends",
      "wordCount": 0,
      "readTime": "Coming Soon",
      "publishedAt": null,
      "isRead": false,
      "isUpcoming": true
    }
  ],
  "reviews": [
    {
      "id": "review1",
      "userId": "user5",
      "userName": "BookLover2024",
      "userAvatar": "https://via.placeholder.com/50x50/FF6B9D/FFFFFF?text=BL",
      "rating": 5,
      "date": "2024-09-18",
      "title": "Mind-blowing cyberpunk masterpiece!",
      "content": "Sarah Chen has created something truly special with The Digital Dreamer. The way she weaves together technology and human consciousness is brilliant. Maya is such a compelling protagonist, and the world-building is incredibly detailed. I couldn't put it down!",
      "helpful": 23,
      "unhelpful": 2,
      "isVerifiedReader": true
    },
    {
      "id": "review2",
      "userId": "user6",
      "userName": "SciFiFan42",
      "userAvatar": "https://via.placeholder.com/50x50/32CD32/FFFFFF?text=SF",
      "rating": 4,
      "date": "2024-09-15",
      "title": "Great start to what promises to be an amazing series",
      "content": "The concept is fascinating and the execution is solid. Some pacing issues in the middle chapters, but the latest updates have really picked up the pace. Can't wait to see where this goes!",
      "helpful": 15,
      "unhelpful": 3,
      "isVerifiedReader": true
    },
    {
      "id": "review3",
      "userId": "user7",
      "userName": "TechReader",
      "userAvatar": "https://via.placeholder.com/50x50/FFD700/000000?text=TR",
      "rating": 5,
      "date": "2024-09-10",
      "title": "Authentic tech details make all the difference",
      "content": "As someone who works in tech, I appreciate how realistic the technical aspects are. Chen clearly knows her stuff. The neural interface concepts are grounded in real science but taken to fascinating extremes.",
      "helpful": 31,
      "unhelpful": 1,
      "isVerifiedReader": true
    }
  ],
  "comments": [
    {
      "id": "comment1",
      "userId": "user8",
      "userName": "CyberReader",
      "userAvatar": "https://via.placeholder.com/40x40/9B59B6/FFFFFF?text=CR",
      "date": "2024-09-20",
      "content": "Just finished chapter 13 and WOW! That cliffhanger is going to keep me up all night. Sarah, you're evil for ending it there! ðŸ˜±",
      "likes": 12,
      "replies": [
        {
          "id": "reply1",
          "userId": "user2",
          "userName": "Sarah Chen",
          "userAvatar": "https://via.placeholder.com/40x40/4A90E2/FFFFFF?text=SC",
          "date": "2024-09-20",
          "content": "Haha, sorry not sorry! ðŸ˜ˆ Chapter 14 is coming soon and it's going to be worth the wait, I promise!",
          "likes": 8,
          "isAuthor": true
        }
      ]
    },
    {
      "id": "comment2",
      "userId": "user9",
      "userName": "DreamHacker",
      "userAvatar": "https://via.placeholder.com/40x40/E74C3C/FFFFFF?text=DH",
      "date": "2024-09-19",
      "content": "The world-building in this novel is incredible. I love how Maya's apartment is described - you can really feel the cyberpunk atmosphere. Anyone else getting major Neuromancer vibes?",
      "likes": 18,
      "replies": []
    },
    {
      "id": "comment3",
      "userId": "user10",
      "userName": "NeuralNet",
      "userAvatar": "https://via.placeholder.com/40x40/FFA500/FFFFFF?text=NN",
      "date": "2024-09-17",
      "content": "Theory time: I think Dr. Elena is not who she seems. There are too many coincidences around her character. Anyone else suspicious?",
      "likes": 7,
      "replies": [
        {
          "id": "reply2",
          "userId": "user11",
          "userName": "TheoryGirl",
          "userAvatar": "https://via.placeholder.com/40x40/FF69B4/FFFFFF?text=TG",
          "date": "2024-09-17",
          "content": "YES! I've been thinking the same thing. Her knowledge of the dream tech seems too convenient...",
          "likes": 4
        }
      ]
    }
  ],
  "relatedNovels": [
    {
      "id": "novel8",
      "title": "Midnight Protocol",
      "author": "Zara Al-Rashid",
      "coverUrl": "https://via.placeholder.com/200x300/800080/FFFFFF?text=Midnight+Protocol",
      "genre": "Cyberpunk",
      "rating": 4.5,
      "stats": {
        "views": 7645,
        "likes": 543
      }
    },
    {
      "id": "novel5",
      "title": "Code of Shadows",
      "author": "Anmol Babuani",
      "coverUrl": "https://via.placeholder.com/200x300/9B59B6/FFFFFF?text=Code+Shadows",
      "genre": "Thriller",
      "rating": 4.8,
      "stats": {
        "views": 23456,
        "likes": 1567
      }
    },
    {
      "id": "novel6",
      "title": "Echoes of Tomorrow",
      "author": "Luna Martinez",
      "coverUrl": "https://via.placeholder.com/200x300/FFA500/FFFFFF?text=Echoes+Tomorrow",
      "genre": "Science Fiction",
      "rating": 4.6,
      "stats": {
        "views": 9876,
        "likes": 678
      }
    }
  ],
  "userProgress": {
    "currentChapter": 2,
    "chaptersRead": 2,
    "progressPercentage": 13,
    "isInLibrary": false,
    "hasRated": false,
    "hasReviewed": false
  }
};

// Application State
class NovelDetailApp {
  constructor() {
    this.data = NOVEL_DATA;
    this.userRating = 0;
    this.isFollowingAuthor = false;
    this.isInLibrary = this.data.userProgress.isInLibrary;
    this.expandedDescription = false;
    this.expandAllChapters = false;
    this.init();
  }

  init() {
    this.renderChaptersList();
    this.renderReviews();
    this.renderComments();
    this.renderRelatedNovels();
    this.setupRatingChart();
    this.setupEventListeners();
    this.setupAnimations();
  }

  setupEventListeners() {
    // Navigation actions
    document.getElementById('add-library-btn')?.addEventListener('click', () => this.toggleLibrary());
    document.getElementById('start-reading-btn')?.addEventListener('click', () => this.startReading());
    document.getElementById('continue-reading-btn')?.addEventListener('click', () => this.continueReading());
    document.getElementById('library-heart-btn')?.addEventListener('click', () => this.toggleLibrary());

    // Author actions
    document.getElementById('follow-author-btn')?.addEventListener('click', () => this.toggleFollowAuthor());
    document.getElementById('follow-author-main-btn')?.addEventListener('click', () => this.toggleFollowAuthor());

    // Description toggle
    document.getElementById('read-more-btn')?.addEventListener('click', () => this.toggleDescription());

    // Chapter controls
    document.getElementById('expand-all-btn')?.addEventListener('click', () => this.toggleExpandChapters());
    document.getElementById('continue-from-current-btn')?.addEventListener('click', () => this.continueReading());

    // Modal controls
    document.getElementById('share-btn')?.addEventListener('click', () => this.openShareModal());
    document.getElementById('write-review-btn')?.addEventListener('click', () => this.openReviewModal());
    
    // Modal close buttons
    document.getElementById('close-share-modal')?.addEventListener('click', () => this.closeModal('share-modal'));
    document.getElementById('close-review-modal')?.addEventListener('click', () => this.closeModal('review-modal'));

    // Share functionality
    document.getElementById('copy-url-btn')?.addEventListener('click', () => this.copyShareUrl());
    document.querySelectorAll('.share-option').forEach(btn => {
      btn.addEventListener('click', (e) => this.shareToSocial(e.target.closest('.share-option').dataset.platform));
    });

    // Review form
    document.getElementById('review-form')?.addEventListener('submit', (e) => this.submitReview(e));
    document.querySelectorAll('#star-rating i').forEach((star, index) => {
      star.addEventListener('click', () => this.setRating(index + 1));
      star.addEventListener('mouseenter', () => this.highlightStars(index + 1));
    });
    document.getElementById('star-rating')?.addEventListener('mouseleave', () => this.resetStarHighlight());

    // Comment form
    document.getElementById('post-comment-btn')?.addEventListener('click', () => this.postComment());

    // Filter buttons
    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.addEventListener('click', (e) => this.filterReviews(e.target.dataset.filter));
    });

    // Modal background click to close
    document.querySelectorAll('.modal').forEach(modal => {
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          modal.classList.add('hidden');
        }
      });
    });
  }

  renderChaptersList() {
    const chaptersContainer = document.getElementById('chapters-list');
    if (!chaptersContainer) return;

    chaptersContainer.innerHTML = '';

    this.data.chapters.forEach((chapter, index) => {
      const chapterItem = document.createElement('div');
      chapterItem.className = `chapter-item ${chapter.isRead ? 'read' : ''} ${chapter.isUpcoming ? 'upcoming' : ''}`;
      
      if (!chapter.isUpcoming) {
        chapterItem.addEventListener('click', () => this.goToChapter(chapter.id));
      }

      chapterItem.innerHTML = `
        <div class="chapter-header">
          <div class="chapter-number">Chapter ${chapter.number}</div>
          <div class="chapter-meta">
            <span><i class="fas fa-file-alt"></i> ${chapter.wordCount.toLocaleString()} words</span>
            <span><i class="fas fa-clock"></i> ${chapter.readTime}</span>
            ${chapter.publishedAt ? `<span><i class="fas fa-calendar"></i> ${this.formatDate(chapter.publishedAt)}</span>` : ''}
          </div>
        </div>
        <div class="chapter-title">${chapter.title}</div>
        <div class="chapter-info">
          ${chapter.isUpcoming ? 'Coming Soon' : `Published ${this.formatDate(chapter.publishedAt)}`}
        </div>
        ${chapter.isRead ? '<div class="read-indicator">Read</div>' : ''}
      `;

      chaptersContainer.appendChild(chapterItem);
    });
  }

  renderReviews() {
    const reviewsContainer = document.getElementById('reviews-container');
    if (!reviewsContainer) return;

    reviewsContainer.innerHTML = '';

    this.data.reviews.forEach(review => {
      const reviewItem = document.createElement('div');
      reviewItem.className = 'review-item';
      reviewItem.setAttribute('data-rating', review.rating);
      
      reviewItem.innerHTML = `
        <div class="review-header">
          <div class="review-user">
            <img src="${review.userAvatar}" alt="${review.userName}" class="review-avatar">
            <div>
              <div class="review-author">${review.userName}</div>
              <div class="review-date">${this.formatDate(review.date)}</div>
            </div>
          </div>
          <div class="review-rating">
            ${this.generateStarRating(review.rating)}
            ${review.isVerifiedReader ? '<div class="verified-reader">Verified Reader</div>' : ''}
          </div>
        </div>
        <div class="review-title">${review.title}</div>
        <div class="review-content">${review.content}</div>
        <div class="review-actions">
          <div class="review-helpful">
            <button class="comment-action" onclick="this.closest('.review-item').querySelector('.helpful-count').textContent = parseInt(this.closest('.review-item').querySelector('.helpful-count').textContent) + 1">
              <i class="fas fa-thumbs-up"></i>
              Helpful (<span class="helpful-count">${review.helpful}</span>)
            </button>
            <button class="comment-action">
              <i class="fas fa-thumbs-down"></i>
              Not Helpful (${review.unhelpful})
            </button>
          </div>
        </div>
      `;

      reviewsContainer.appendChild(reviewItem);
    });
  }

  renderComments() {
    const commentsContainer = document.getElementById('comments-container');
    if (!commentsContainer) return;

    commentsContainer.innerHTML = '';

    this.data.comments.forEach(comment => {
      const commentItem = document.createElement('div');
      commentItem.className = 'comment-item';
      
      commentItem.innerHTML = `
        <div class="comment-header">
          <div class="comment-user">
            <img src="${comment.userAvatar}" alt="${comment.userName}" class="comment-avatar">
            <div>
              <div class="comment-author">
                ${comment.userName}
                ${comment.isAuthor ? '<span class="author-badge">Author</span>' : ''}
              </div>
              <div class="comment-time">${this.formatDate(comment.date)}</div>
            </div>
          </div>
        </div>
        <div class="comment-content">${comment.content}</div>
        <div class="comment-actions">
          <button class="comment-action" onclick="this.querySelector('.like-count').textContent = parseInt(this.querySelector('.like-count').textContent) + 1">
            <i class="fas fa-heart"></i>
            <span class="like-count">${comment.likes}</span>
          </button>
          <button class="comment-action">
            <i class="fas fa-reply"></i>
            Reply
          </button>
        </div>
        ${comment.replies && comment.replies.length > 0 ? this.renderReplies(comment.replies) : ''}
      `;

      commentsContainer.appendChild(commentItem);
    });
  }

  renderReplies(replies) {
    let repliesHtml = '<div class="comment-replies">';
    
    replies.forEach(reply => {
      repliesHtml += `
        <div class="comment-item">
          <div class="comment-header">
            <div class="comment-user">
              <img src="${reply.userAvatar}" alt="${reply.userName}" class="comment-avatar">
              <div>
                <div class="comment-author">
                  ${reply.userName}
                  ${reply.isAuthor ? '<span class="author-badge">Author</span>' : ''}
                </div>
                <div class="comment-time">${this.formatDate(reply.date)}</div>
              </div>
            </div>
          </div>
          <div class="comment-content">${reply.content}</div>
          <div class="comment-actions">
            <button class="comment-action" onclick="this.querySelector('.like-count').textContent = parseInt(this.querySelector('.like-count').textContent) + 1">
              <i class="fas fa-heart"></i>
              <span class="like-count">${reply.likes}</span>
            </button>
          </div>
        </div>
      `;
    });
    
    repliesHtml += '</div>';
    return repliesHtml;
  }

  renderRelatedNovels() {
    const relatedContainer = document.getElementById('related-novels');
    if (!relatedContainer) return;

    relatedContainer.innerHTML = '';

    this.data.relatedNovels.forEach(novel => {
      const novelCard = document.createElement('div');
      novelCard.className = 'related-novel-card';
      novelCard.addEventListener('click', () => this.goToNovel(novel.id));
      
      novelCard.innerHTML = `
        <img src="${novel.coverUrl}" alt="${novel.title}" class="related-cover">
        <div class="related-info">
          <h4>${novel.title}</h4>
          <div class="related-author">${novel.author}</div>
          <div class="related-meta">
            <span class="related-genre">${novel.genre}</span>
            <div class="related-stats">
              <div class="stat-item">
                <i class="fas fa-star"></i>
                ${novel.rating}
              </div>
              <div class="stat-item">
                <i class="fas fa-eye"></i>
                ${this.formatNumber(novel.stats.views)}
              </div>
            </div>
          </div>
        </div>
      `;

      relatedContainer.appendChild(novelCard);
    });
  }

  setupRatingChart() {
    const canvas = document.getElementById('rating-chart');
    if (!canvas) return;

    const ctx = canvas.getContext('2d');
    const ratingData = this.data.novel.ratingBreakdown;
    
    new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: ['5 Stars', '4 Stars', '3 Stars', '2 Stars', '1 Star'],
        datasets: [{
          data: [ratingData['5'], ratingData['4'], ratingData['3'], ratingData['2'], ratingData['1']],
          backgroundColor: ['#1FB8CD', '#FFC185', '#B4413C', '#ECEBD5', '#5D878F'],
          borderWidth: 0
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'bottom',
            labels: {
              color: '#ffffff',
              font: {
                size: 12
              },
              padding: 15
            }
          }
        }
      }
    });
  }

  setupAnimations() {
    // Intersection Observer for slide-in animations
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('slide-in');
        }
      });
    }, { threshold: 0.1 });

    document.querySelectorAll('.info-card, .chapter-item, .review-item, .comment-item').forEach(el => {
      observer.observe(el);
    });
  }

  toggleLibrary() {
    this.isInLibrary = !this.isInLibrary;
    
    const libraryBtns = document.querySelectorAll('#add-library-btn, #library-heart-btn');
    libraryBtns.forEach(btn => {
      const icon = btn.querySelector('i');
      if (this.isInLibrary) {
        btn.classList.add('heart-animation');
        icon.classList.remove('far');
        icon.classList.add('fas');
        if (btn.id === 'add-library-btn') {
          btn.innerHTML = '<i class="fas fa-check"></i> In Library';
        } else {
          btn.innerHTML = '<i class="fas fa-heart"></i> In Library';
        }
      } else {
        icon.classList.remove('fas');
        icon.classList.add('far');
        if (btn.id === 'add-library-btn') {
          btn.innerHTML = '<i class="fas fa-plus"></i> Add to Library';
        } else {
          btn.innerHTML = '<i class="far fa-heart"></i> Add to Library';
        }
      }
      
      setTimeout(() => btn.classList.remove('heart-animation'), 600);
    });

    this.showToast(this.isInLibrary ? 'Added to your library!' : 'Removed from library');
  }

  toggleFollowAuthor() {
    this.isFollowingAuthor = !this.isFollowingAuthor;
    
    const followBtns = document.querySelectorAll('#follow-author-btn, #follow-author-main-btn');
    followBtns.forEach(btn => {
      if (this.isFollowingAuthor) {
        btn.innerHTML = '<i class="fas fa-user-check"></i> Following';
        btn.classList.remove('btn--primary');
        btn.classList.add('btn--outline');
      } else {
        btn.innerHTML = '<i class="fas fa-user-plus"></i> Follow Author';
        btn.classList.remove('btn--outline');
        btn.classList.add('btn--primary');
      }
    });

    this.showToast(this.isFollowingAuthor ? 'Now following Sarah Chen!' : 'Unfollowed Sarah Chen');
  }

  startReading() {
    this.goToChapter('ch1');
  }

  continueReading() {
    const currentChapter = this.data.userProgress.currentChapter;
    const nextChapterId = `ch${currentChapter + 1}`;
    this.goToChapter(nextChapterId);
  }

  goToChapter(chapterId) {
    this.showToast(`Opening ${chapterId}...`);
    // In a real app, this would navigate to the reader page
    console.log(`Navigating to chapter: ${chapterId}`);
  }

  goToNovel(novelId) {
    this.showToast(`Opening novel ${novelId}...`);
    // In a real app, this would navigate to another novel detail page
    console.log(`Navigating to novel: ${novelId}`);
  }

  toggleDescription() {
    this.expandedDescription = !this.expandedDescription;
    
    const fullDescription = document.getElementById('full-description');
    const readMoreBtn = document.getElementById('read-more-btn');
    
    if (this.expandedDescription) {
      fullDescription.classList.remove('hidden');
      readMoreBtn.textContent = 'Read Less';
    } else {
      fullDescription.classList.add('hidden');
      readMoreBtn.textContent = 'Read More';
    }
  }

  toggleExpandChapters() {
    this.expandAllChapters = !this.expandAllChapters;
    
    const expandBtn = document.getElementById('expand-all-btn');
    const chapterItems = document.querySelectorAll('.chapter-item');
    
    if (this.expandAllChapters) {
      expandBtn.innerHTML = '<i class="fas fa-compress-alt"></i> Collapse All';
      chapterItems.forEach(item => item.classList.add('expanded'));
    } else {
      expandBtn.innerHTML = '<i class="fas fa-expand-alt"></i> Expand All';
      chapterItems.forEach(item => item.classList.remove('expanded'));
    }
  }

  openShareModal() {
    document.getElementById('share-modal').classList.remove('hidden');
  }

  openReviewModal() {
    document.getElementById('review-modal').classList.remove('hidden');
  }

  closeModal(modalId) {
    document.getElementById(modalId).classList.add('hidden');
  }

  copyShareUrl() {
    const urlInput = document.getElementById('share-url-input');
    urlInput.select();
    document.execCommand('copy');
    this.showToast('Link copied to clipboard!');
  }

  shareToSocial(platform) {
    const url = 'https://anmol.com/novel/the-digital-dreamer';
    const text = `Check out "${this.data.novel.title}" by ${this.data.novel.author} on Anmol!`;
    
    let shareUrl = '';
    
    switch (platform) {
      case 'twitter':
        shareUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`;
        break;
      case 'facebook':
        shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`;
        break;
      case 'reddit':
        shareUrl = `https://reddit.com/submit?url=${encodeURIComponent(url)}&title=${encodeURIComponent(text)}`;
        break;
      case 'copy':
        this.copyShareUrl();
        return;
    }
    
    if (shareUrl) {
      window.open(shareUrl, '_blank', 'width=600,height=400');
    }
    
    this.closeModal('share-modal');
  }

  setRating(rating) {
    this.userRating = rating;
    this.updateStarDisplay();
  }

  highlightStars(rating) {
    const stars = document.querySelectorAll('#star-rating i');
    stars.forEach((star, index) => {
      if (index < rating) {
        star.classList.add('active');
      } else {
        star.classList.remove('active');
      }
    });
  }

  resetStarHighlight() {
    this.updateStarDisplay();
  }

  updateStarDisplay() {
    const stars = document.querySelectorAll('#star-rating i');
    stars.forEach((star, index) => {
      if (index < this.userRating) {
        star.classList.add('active');
      } else {
        star.classList.remove('active');
      }
    });
  }

  submitReview(e) {
    e.preventDefault();
    
    const title = document.getElementById('review-title').value;
    const content = document.getElementById('review-content').value;
    
    if (!this.userRating) {
      this.showToast('Please select a rating');
      return;
    }
    
    if (!title.trim() || !content.trim()) {
      this.showToast('Please fill in all fields');
      return;
    }

    // In a real app, this would submit to a server
    this.showToast('Review submitted successfully!');
    this.closeModal('review-modal');
    
    // Reset form
    document.getElementById('review-form').reset();
    this.userRating = 0;
    this.updateStarDisplay();
  }

  postComment() {
    const commentInput = document.getElementById('comment-input');
    const content = commentInput.value.trim();
    
    if (!content) {
      this.showToast('Please enter a comment');
      return;
    }

    // In a real app, this would submit to a server
    this.showToast('Comment posted successfully!');
    commentInput.value = '';
  }

  filterReviews(filter) {
    // Update active filter button
    document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
    document.querySelector(`[data-filter="${filter}"]`).classList.add('active');
    
    const reviewItems = document.querySelectorAll('.review-item');
    
    reviewItems.forEach(item => {
      const rating = item.getAttribute('data-rating');
      let shouldShow = true;
      
      switch (filter) {
        case 'all':
          shouldShow = true;
          break;
        case '5':
        case '4':
          shouldShow = rating === filter;
          break;
        case 'recent':
          // In a real app, this would sort by date
          shouldShow = true;
          break;
      }
      
      item.style.display = shouldShow ? 'block' : 'none';
    });
  }

  generateStarRating(rating) {
    let stars = '';
    for (let i = 1; i <= 5; i++) {
      if (i <= rating) {
        stars += '<i class="fas fa-star"></i>';
      } else if (i - 0.5 <= rating) {
        stars += '<i class="fas fa-star-half-alt"></i>';
      } else {
        stars += '<i class="far fa-star"></i>';
      }
    }
    return stars;
  }

  formatNumber(num) {
    if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
    if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
    return num.toString();
  }

  formatDate(dateString) {
    const date = new Date(dateString);
    return date.toLocaleDateString('en-US', { 
      year: 'numeric', 
      month: 'short', 
      day: 'numeric' 
    });
  }

  showToast(message) {
    // Create toast element
    const toast = document.createElement('div');
    toast.className = 'toast';
    toast.style.cssText = `
      position: fixed;
      top: 100px;
      right: 20px;
      background: var(--anmol-purple);
      color: white;
      padding: 1rem 1.5rem;
      border-radius: 8px;
      z-index: 3000;
      opacity: 0;
      transform: translateX(100%);
      transition: all 0.3s ease;
      font-weight: 500;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    `;
    toast.textContent = message;
    
    document.body.appendChild(toast);
    
    // Animate in
    setTimeout(() => {
      toast.style.opacity = '1';
      toast.style.transform = 'translateX(0)';
    }, 100);
    
    // Remove after 3 seconds
    setTimeout(() => {
      toast.style.opacity = '0';
      toast.style.transform = 'translateX(100%)';
      setTimeout(() => {
        document.body.removeChild(toast);
      }, 300);
    }, 3000);
  }
}

// Initialize the application
document.addEventListener('DOMContentLoaded', () => {
  const app = new NovelDetailApp();
  window.novelApp = app; // Make globally available for debugging
});